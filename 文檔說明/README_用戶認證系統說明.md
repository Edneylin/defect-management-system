# 不良品管理系統 - 用戶認證系統說明

## 📋 功能概述

本次更新為不良品管理系統增加了完整的用戶認證功能，確保所有用戶都需要通過身份驗證才能使用系統，提升系統安全性和操作可追溯性。

## 🔐 核心功能

### 1. 用戶登入認證
- **強制登入**：所有用戶必須輸入正確的用戶名和密碼才能進入系統
- **密碼加密**：使用SHA-256哈希算法加密存儲用戶密碼
- **會話管理**：登入後維持用戶會話狀態，直到主動登出
- **登入記錄**：自動記錄用戶最後登入時間

### 2. 用戶管理功能
- **新增用戶**：管理員可以新增新用戶帳戶
- **用戶資料管理**：設定用戶姓名、部門、職位、角色等資訊
- **帳戶狀態控制**：可啟用/停用用戶帳戶
- **密碼重設**：管理員可重設用戶密碼

### 3. 權限控制
- **角色分級**：支援不同用戶角色（管理員、主管、工程師等）
- **操作追蹤**：所有操作都會記錄操作者身份
- **部門權限**：根據用戶部門自動分配相應權限

## 🗄️ 資料庫結構

### users 表結構
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,           -- 用戶名（登入帳號）
    password_hash TEXT NOT NULL,             -- 密碼哈希值
    name TEXT NOT NULL,                      -- 真實姓名
    department TEXT NOT NULL,                -- 部門
    position TEXT NOT NULL,                  -- 職位
    role TEXT NOT NULL,                      -- 角色
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- 帳戶建立時間
    last_login TIMESTAMP,                    -- 最後登入時間
    is_active BOOLEAN DEFAULT 1              -- 帳戶狀態（1=啟用，0=停用）
)
```

## 👤 預設管理員帳戶

系統會自動建立預設管理員帳戶：
- **用戶名**：`admin`
- **姓名**：系統管理員
- **部門**：資訊部
- **角色**：管理員

> ⚠️ **重要提醒**：如需登入密碼，請聯繫系統管理員或部署人員

## 🔧 使用說明

### 首次啟動系統
1. 執行 `streamlit run defect_management_system.py`
2. 系統會自動顯示登入頁面
3. 使用管理員帳戶登入（請聯繫系統管理員取得登入資訊）
4. 進入「用戶管理」頁面新增其他用戶

### 登入流程
1. 在登入頁面輸入用戶名和密碼
2. 點擊「🔐 登入」按鈕
3. 驗證成功後進入系統主頁面
4. 右上角會顯示當前登入用戶資訊

### 新增用戶
1. 以管理員身份登入系統
2. 進入「👥 用戶管理」頁面
3. 點擊「➕ 新增用戶」
4. 填寫用戶資訊並設定密碼
5. 點擊「新增用戶」完成建立

### 用戶管理
- **查看用戶列表**：顯示所有用戶的基本資訊和狀態
- **啟用/停用用戶**：控制用戶帳戶的使用權限
- **重設密碼**：為用戶重新設定密碼
- **編輯用戶資料**：修改用戶的部門、職位等資訊

## 🔄 系統整合

### 不良品登錄
- 登錄人員自動使用當前登入用戶的姓名
- 顯示用戶的部門和職位資訊
- 所有操作都會記錄操作者身份

### 處理追蹤
- 所有處理動作都會記錄操作者
- 轉交、簽核、退回等操作都有操作者追蹤
- 刪除記錄時會記錄刪除者身份

### 系統設定
- 移除舊的「當前用戶」設定功能
- 顯示當前登入用戶的詳細資訊
- 所有設定變更都有操作者記錄

## 🛡️ 安全特性

### 密碼安全
- 使用SHA-256哈希算法加密密碼
- 密碼不以明文形式存儲
- 支援密碼複雜度要求

### 會話安全
- 會話狀態存儲在Streamlit session_state中
- 頁面刷新後保持登入狀態
- 支援主動登出功能

### 操作追蹤
- 所有關鍵操作都記錄操作者身份
- 提供完整的操作審計軌跡
- 支援操作歷史查詢

## 🔍 測試驗證

系統包含完整的測試腳本 `test_authentication_system.py`，測試內容包括：
- 資料庫結構驗證
- 預設管理員帳戶測試
- 認證函數測試
- 用戶管理功能測試

執行測試：
```bash
python test_authentication_system.py
```

## 📱 用戶界面更新

### 登入頁面
- 簡潔的登入表單設計
- 用戶名和密碼輸入框
- 錯誤訊息顯示
- 友善的操作提示

### 用戶管理頁面
- 用戶列表展示
- 新增用戶表單
- 用戶狀態管理
- 密碼重設功能

### 系統導航
- 側邊欄顯示當前用戶資訊
- 登出按鈕
- 用戶管理入口（僅管理員可見）

## 🚀 升級影響

### 向後兼容
- 現有的不良品記錄完全保留
- 系統設定和通知設定不受影響
- 舊的操作記錄保持完整

### 功能增強
- 提升系統安全性
- 增強操作可追溯性
- 改善用戶體驗
- 支援多用戶協作

## 💡 使用建議

### 管理員
1. 首次登入後立即修改預設密碼
2. 為每個實際使用者建立專屬帳戶
3. 定期檢查用戶帳戶狀態
4. 適時停用離職人員帳戶

### 一般用戶
1. 妥善保管登入密碼
2. 使用完畢後主動登出
3. 如需修改密碼請聯繫管理員
4. 發現帳戶異常請立即報告

## 🔧 故障排除

### 無法登入
- 檢查用戶名和密碼是否正確
- 確認帳戶是否被停用
- 聯繫管理員重設密碼

### 忘記密碼
- 聯繫系統管理員重設密碼
- 管理員可在用戶管理頁面進行重設

### 權限問題
- 確認用戶角色設定是否正確
- 檢查用戶所屬部門是否正確
- 聯繫管理員調整權限設定

---

## 📞 技術支援

如有任何問題或建議，請聯繫系統管理員或開發團隊。

**更新日期**：2025年6月18日  
**版本**：v2.0 - 用戶認證系統 
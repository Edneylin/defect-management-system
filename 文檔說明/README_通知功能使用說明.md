# 📢 不良品管理系統 - 通知功能使用說明

## 🌟 通知功能概述

本系統提供多種通知方式，確保重要的不良品處理訊息能及時傳達給相關人員：

- 📧 **郵件通知**：傳統可靠的郵件提醒
- 📱 **Telegram通知**：現代化即時通訊提醒（替代LINE Notify）

> ⚠️ **重要更新**：由於LINE Notify已於2024年4月1日停止新用戶註冊，我們推薦使用功能更強大的**Telegram Bot**作為替代方案。

---

## 🚀 快速開始

### 1. 進入系統設定
- 開啟不良品管理系統
- 點選側邊欄的 **「⚙️ 系統設定」**

### 2. 選擇通知方式
- 勾選您需要的通知方式：
  - ☑️ 📧 郵件通知
  - ☑️ 📱 Telegram通知

### 3. 設定通知參數
- 依照您選擇的通知方式填入相關設定
- 點選 **「💾 儲存設定」**

### 4. 測試通知功能
- 點選對應的測試按鈕驗證設定是否正確

---

## 📧 郵件通知設定

### 基本設定
| 項目 | 說明 | 範例 |
|------|------|------|
| SMTP伺服器 | 郵件服務商的SMTP伺服器 | smtp.gmail.com |
| SMTP埠號 | 通常為587或465 | 587 |
| 使用者名稱 | 您的郵件帳號 | your-email@gmail.com |
| 密碼 | 應用程式密碼（非登入密碼） | abcd efgh ijkl mnop |
| 收件人 | 接收通知的郵件地址 | manager@company.com |

### Gmail設定步驟
1. **啟用兩步驟驗證**
2. **產生應用程式密碼**：
   - 前往 Google 帳戶設定
   - 選擇「安全性」→「應用程式密碼」
   - 選擇「其他」並輸入「不良品管理系統」
   - 複製產生的16位密碼

### 支援的郵件服務商
- **Gmail**：smtp.gmail.com:587
- **Outlook**：smtp-mail.outlook.com:587
- **Yahoo**：smtp.mail.yahoo.com:587
- **企業郵箱**：請洽詢IT部門

---

## 📱 Telegram通知設定

### 為什麼選擇Telegram？
✅ **完全免費**且功能強大  
✅ **國際通用**，無地區限制  
✅ **即時推送**，送達率高  
✅ **群組支援**，支援團隊協作  
✅ **豐富格式**，支援HTML格式和連結  

### 設定步驟

#### 步驟1：創建Bot
1. 搜尋 **@BotFather** 並開始對話
2. 發送 `/newbot` 命令
3. 輸入機器人名稱和用戶名
4. 複製獲得的 **Bot Token**

#### 步驟2：取得聊天室ID
**個人通知：**
1. 與您的Bot對話並發送訊息
2. 前往：`https://api.telegram.org/bot您的TOKEN/getUpdates`
3. 找到 `"chat" -> "id"` 數值

**群組通知：**
1. 建立群組並邀請Bot加入
2. 在群組發送 `/start`
3. 同樣方式取得群組ID（通常為負數）

#### 步驟3：系統設定
1. 在系統設定中填入 **Bot Token**
2. 填入 **聊天室ID**（每行一個）
3. 點選測試按鈕驗證

---

## ⏰ 自動通知規則

### 處理時限
| 不良品等級 | 處理時限 | 提醒頻率 |
|-----------|----------|----------|
| 🔴 A級 | 4小時內 | 每2小時提醒 |
| 🟡 B級 | 8小時內 | 每4小時提醒 |
| 🔵 C級 | 24小時內 | 每8小時提醒 |

### 通知內容
每次通知都包含：
- 📍 **責任部門**
- 📊 **逾期案件數量**
- 📋 **詳細案件清單**：
  - 工單號碼
  - 產品名稱
  - 不良品等級
  - 數量
  - 建立時間
  - 逾期時長
- 🔗 **系統連結**

### 背景監控
- ⏰ **檢查頻率**：每小時檢查一次
- 🎯 **智能提醒**：避免重複通知
- 🔄 **自動執行**：無需人工干預

---

## 🎨 通知訊息範例

### 📧 郵件通知範例
```
主題：🚨 不良品處理逾期提醒 - 品質部

不良品處理逾期提醒

部門：品質部
逾期案件數：2 件

詳細案件：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
工單：WO-2024-001
產品：iPhone 15 外殼
等級：A級
數量：50 pcs
建立時間：06/18 08:30
逾期時長：6.5 小時
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

進入系統：http://localhost:8501
通知時間：2024-06-18 15:00:00
```

### 📱 Telegram通知範例
```
🚨 不良品處理逾期提醒

📍 部門：品質部
📊 逾期案件數：2 件

📋 詳細案件：
━━━━━━━━━━━━━━━━━━━━
🏷️ 工單：WO-2024-001
📦 產品：iPhone 15 外殼
⚠️ 等級：A級
📈 數量：50 pcs
⏰ 建立：06/18 08:30
🔴 逾期：6.5 小時
━━━━━━━━━━━━━━━━━━━━
🔗 進入系統
⏰ 通知時間：2024-06-18 15:00:00
```

---

## 🛠️ 故障排除

### 常見問題

#### 📧 郵件通知問題
**Q：郵件發送失敗？**
- 檢查SMTP設定是否正確
- 確認使用應用程式密碼而非登入密碼
- 檢查網路連線和防火牆設定

**Q：郵件被歸類為垃圾郵件？**
- 請收件人將系統郵件加入白名單
- 使用企業郵箱提高信任度

#### 📱 Telegram通知問題
**Q：無法取得聊天室ID？**
- 確認已與Bot對話或邀請Bot加入群組
- 檢查Bot Token是否正確
- 使用瀏覽器開發者工具查看JSON回應

**Q：群組通知收不到？**
- 確認Bot已加入群組且有發送權限
- 檢查群組ID是否為負數
- 嘗試重新邀請Bot

### 系統日誌
- 通知發送狀態會記錄在系統日誌中
- 如遇問題，請檢查控制台輸出訊息

---

## 🔒 安全性建議

### 資料保護
- 📧 **郵件密碼**：使用應用程式密碼，定期更換
- 📱 **Bot Token**：妥善保管，不要分享給未授權人員
- 💾 **設定備份**：定期備份 `notification_settings.json`

### 權限控制
- 👥 **收件人管理**：只添加需要接收通知的人員
- 🔐 **群組管理**：定期檢查Telegram群組成員
- 📋 **存取記錄**：定期檢視通知發送記錄

---

## 📈 最佳實務

### 通知策略
1. **分級通知**：不同等級的不良品設定不同的通知群組
2. **多重通知**：重要案件同時使用郵件和Telegram
3. **測試優先**：新設定完成後務必進行測試
4. **定期檢查**：定期確認通知功能正常運作

### 組織建議
- **品質部群組**：接收所有不良品通知
- **生產部群組**：接收生產相關通知
- **主管群組**：接收A級緊急通知
- **個人通知**：負責人個人即時提醒

---

## 📞 技術支援

如果您在使用過程中遇到問題：

1. **檢查設定**：確認所有設定項目都已正確填入
2. **測試功能**：使用測試按鈕驗證設定
3. **查看日誌**：觀察系統控制台的錯誤訊息
4. **重新啟動**：嘗試重新啟動系統

---

*📝 本文件最後更新：2024年6月*  
*🔄 隨著系統功能更新，本說明文件也會持續改進* 